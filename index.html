<!doctype html>
<html>
    <head>
        <title>Langton's Ants</title>
        <link rel="stylesheet" type="text/css" href="style.css" />
        <script src="grid.js" language="JavaScript"></script>
        <script src="ant.js" language="JavaScript"></script>
    </head>
    <body>
        <div id="container">
            <canvas id="grid"></canvas>
            <button id="run_ctl">Play</button>
            <button id="slower">Slower</button>
            <button id="faster">Faster</button>
            <div style="float: left">
                <label for="iteration">Iteration:</label>
                <input id="iteration" type="text" size="6" />
            </div>
        </div>
        <script language="JavaScript">
            (function () {
                var grid = document.getElementById('grid');
                grid = new Ants.Grid(grid, 10, 10);

                var ant = new Ants.Ant(
                    Math.floor(grid.rows/2), Math.floor(grid.cols/2)
                );
                grid.addAnt(ant);

                var i = null;

                var delay = 64;

                var faster = document.getElementById('faster');
                var slower = document.getElementById('slower');

                slower.addEventListener('click', function() {
                    var running = i != null;
                    if (running)
                        pause();
                    delay *= 2;
                    faster.disabled = delay <= 1;
                    if (running)
                        play();
                });

                faster.addEventListener('click', function() {
                    var running = i != null;
                    if (running)
                        pause();
                    if (delay > 1)
                        delay /= 2;
                    else
                        faster.disabled = true;
                    if (running)
                        play();
                });

                var iteration = document.getElementById('iteration');
                iteration.value = grid.iteration.toString();
                iteration.addEventListener('change', function() {
                    var i = parseInt(iteration.value);
                    if (isNaN(i) || i < grid.iteration)
                        iteration.value = grid.iteration.toString();
                    else
                        grid.setIteration(i);
                });

                function step() {
                    grid.step();
                    iteration.value = grid.iteration.toString();
                }

                function play() {
                    i = setInterval(step, delay);
                    iteration.readOnly = true;
                }

                function pause() {
                    if (i != null) {
                        clearInterval(i);
                        i = null;
                        iteration.readOnly = false;
                    }
                }

                window.addEventListener('error', function() {
                    pause();
                });

                var runctl = document.getElementById('run_ctl');
                runctl.addEventListener('click', function() {
                    if (i == null) {
                        play();
                        runctl.innerText = 'Pause';
                    } else {
                        pause();
                        runctl.innerText = 'Play';
                    }
                });
            })();
        </script>
    </body>
</html>
